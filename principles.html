<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.35">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Principles of code review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>


<script src="principles_files/libs/clipboard/clipboard.min.js"></script>
<script src="principles_files/libs/quarto-html/quarto.js"></script>
<script src="principles_files/libs/quarto-html/popper.min.js"></script>
<script src="principles_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="principles_files/libs/quarto-html/anchor.min.js"></script>
<link href="principles_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="principles_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="principles_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="principles_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="principles_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Principles of code review</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>‚ÄúThere‚Äôs scarcely any guidance on preparing your code for review, so authors often screw up this process out of sheer ignorance.‚Äù - Michael Lynch</p>
<p>The point of these principles is to provide some actual guidance on code review at RStudio and for the larger R community.</p>
</section>
<section id="why-do-we-care" class="level2">
<h2 class="anchored" data-anchor-id="why-do-we-care">Why do we care?</h2>
<ul>
<li><p>Doing this somewhat consistently internally will set a model that new members of our team can follow, which in turn makes everyone‚Äôs lives easier.</p></li>
<li><p>It‚Äôs the help-me-help-you mantra of reprex all over again. By being a good pull request writer, you make it easier for your colleague to be a good pull request reviewer, which in turn leads to better code.</p></li>
</ul>
</section>
<section id="be-your-own-critic" class="level2">
<h2 class="anchored" data-anchor-id="be-your-own-critic">Be your own critic</h2>
<p>Before handing off a pull request to someone else, ensure that you‚Äôve done your due diligence to check for typos, syntax issues, and potential bugs you might have introduced. It is perfectly acceptable to finish a feature, sit on it for the night, review it the next morning yourself, and <em>then</em> open the pull request. You‚Äôd be surprised at how many bugs you can catch yourself, freeing up the mental space of your reviewer.</p>
<p>This principle could also be called ‚ÄúRespect your reviewer‚Äôs time.‚Äù Remember that someone is taking time out of their day to review your work; you should be respectful of that! Even if it is part of their job, they often have their own responsibilities to work on as well. Reviewing your code is pulling from their finite supply of focus and hours in the day.</p>
<p>Commenting on your own pull requests is a super power.</p>
<ul>
<li>Practically, on GitHub this involves first opening the pull request and submitting it, then following up to ‚Äúleave a review‚Äù yourself, adding comments on specific lines of the code you touched.</li>
</ul>
<!-- -->
<ul>
<li><p>It allows you to raise awareness of places in your changes that don‚Äôt quite warrant a code comment, but are still meaningful to point out for the reviewer. Example: Explaining that line 603 is the particularly problematic one that is now covered by the new test you added.</p></li>
<li><p>It allows you to start a conversation about particular points of the feature you feel like you might still need help with. Example: ‚ÄúI‚Äôve written this as an if/else statement, but it might be cleaner as an early return. Do you have any preference?‚Äù</p></li>
<li><p>The other really nice thing about doing something like this on GitHub is that the comment you open with a discussion point is a natural place to expand a <em>thread</em> of comments specifically about that point. All of the comments about that part of the feature are localized to the area in the code that it affects, and then can be minimized all at once when the discussion is finished.</p></li>
</ul>
<p>Use the opening comment of your pull request as a way to bring your reviewer up to speed. For me, the best pull requests are ones where I can guess at the code changes based on reading the opening comment, without even looking at the files that have been changed.</p>
<ul>
<li><p>Link to any issues that this pull request closes, using the special <code>Fixes #502</code> or <code>Closes #502</code> syntax that GitHub allows. You might also link to any related issues or pull requests.</p></li>
<li><p>If applicable, show the output of the original buggy issue before and after running the pull request. This is a clear indicator of what behavior has changed.</p></li>
</ul>
<p>Wait for CI to pass before asking for a review. A failing CI build often means that you need to make more changes to the pull request, and you should try to get as many of the small things out of the way first before bringing in your reviewer.</p>
</section>
<section id="write-for-the-code-archaeologists" class="level2">
<h2 class="anchored" data-anchor-id="write-for-the-code-archaeologists">Write for the code archaeologists</h2>
<p>Even if you aren‚Äôt planning on asking for a review from someone else, it is often useful to document your pull requests as outlined above. Your reviewer might not be someone today, but it might be <em>you</em> six months from now when the feature you thought you added correctly starts having an issue. You‚Äôll be thankful for documentation that outlines the feature and any tricky parts of the code you were aware of at the time when you added it.</p>
<p>Additionally, it is always worth linking to the issue number that prompted this pull request somewhere in the codebase. This ensures that future you (or your colleague) will be able to dig up the pull request more easily in the future if something isn‚Äôt working right. There are three places I normally put sign posts like these, in decreasing order of frequency:</p>
<ul>
<li><p>NEWS bullets. Almost all pull requests should get a NEWS bullet. Even if this isn‚Äôt a user facing change, it can often be useful to document ‚Äúinternal changes‚Äù in a section for the development team to reference in the future. The RStudio IDE will now also automatically create a hyperlink from something like <code>#534</code> to the issue page on the project‚Äôs GitHub repository.</p></li>
<li><p>The relevant test. Most pull requests also gain a related test to ensure that the bug never creeps up again. This is a <em>great</em> place to add the issue number. The RStudio IDE will also link issues mentioned here to GitHub.</p></li>
<li><p>As a code comment in the code itself. I do this somewhat rarely, because I don‚Äôt want to clutter otherwise understandable code with extra comments. I typically do this in two places:</p>
<ul>
<li><p>When the finalized code (after the fix) looks so innocuous that someone might be tempted to change it in the future, you can head that off by adding a comment describing <em>why</em> the code is the way it is with a link back to the original issue (a good test will also catch this).</p></li>
<li><p>When I have a TODO that can‚Äôt be fixed at the current moment because it is blocked by another issue, but is something I‚Äôd like to come back to once that other issue is solved. In those cases, I often link out to the blocking issue instead of the one I am currently solving.</p></li>
</ul></li>
</ul>
<p>In the cases where you submit a pull request that doesn‚Äôt close an issue, I will often open the pull request to force it to generate a pull request number on GitHub, then follow up with a second commit that adds the pull request number to the NEWS bullet or relevant test.</p>
</section>
<section id="do-one-thing" class="level2">
<h2 class="anchored" data-anchor-id="do-one-thing">Do one thing</h2>
<p>Pull requests that are limited to doing <em>exactly</em> one thing make your reviewer‚Äôs life much easier. As a reviewer, if you are looking at a pull request that fixes a bug <em>and</em> works in a few other documentation improvements, it is much harder to review than two separate pull requests that accomplish the same thing. Resist the urge to do <em>one more thing</em> in your pull requests.</p>
<p>Limiting your pull requests to one idea allows your reviewer to think more deeply about the code itself, which often results in more meaningful feedback and a higher percentage chance of catching edge cases.</p>
</section>
<section id="respond-to-your-reviewers" class="level2">
<h2 class="anchored" data-anchor-id="respond-to-your-reviewers">Respond to your reviewers</h2>
<p>If someone is nice enough to leave you a review, the least you can do is respond to their comments. This might be as simple as giving the comment a üëç and then minimizing it after making the change, but some kind of recognition of their efforts to help you out is always appreciated. I also find that minimizing comments like that is a great way to keep track of what you have tackled, and what part of the review you still have to finish up!</p>
</section>
<section id="advice-for-the-reviewer" class="level2">
<h2 class="anchored" data-anchor-id="advice-for-the-reviewer">Advice for the reviewer</h2>
<ul>
<li><p>Pull requests often take a long time to review, and that is okay. For a sizable review, it can sometimes take me thirty minutes to an hour to fully vet it. This should be normalized, and is part of your work responsibilities. Don‚Äôt just give it a LGTM and move on.</p></li>
<li><p>Check out the pull request locally. Tools like <code>usethis::pr_fetch()</code> make this laughably easy. Try out edge cases yourself, look for places where the changes might fall short. This also gives you a chance to make a meaningful reprex for the pull request writer if you do find a bug.</p></li>
<li><p>Live reviewing someone else‚Äôs pull request can be a great way to pair program. As the pull request writer, you get a peek into how the other person is thinking about your code, which can give you a lot of insight into how you could structure your pull request to make it easier for them to review in the future. As the pull request reviewer, you get a chance to ask questions about parts of the code that you are immediately confused by.</p></li>
<li><p>Review as you‚Äôd want to be reviewed. i.e.&nbsp;be nice and thoughtful when leaving critical feedback. Know that ‚Äúmeaning‚Äù is hard to express through text and can be interpreted differently by different people.</p>
<ul>
<li>Don‚Äôt just say, ‚Äúthis is confusing.‚Äù This is often hard to interpret, is too ambiguous, and can be frustrating for the person writing the pull request who receives this feedback. Try to be specific about what exactly is confusing, and offer up a potential solution or a suggestion to add a test or comment about what is happening there.</li>
</ul></li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p><a href="https://mtlynch.io/code-review-love/" class="uri">https://mtlynch.io/code-review-love/</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>